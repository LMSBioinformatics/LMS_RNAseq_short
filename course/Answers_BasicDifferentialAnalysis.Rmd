---
title: "BasicDifferentialAnalysis"
author: "MRC CSC Bioinformatics Core"
date: "08 August 2016"
output: html_document
Website: http://bioinformatics.csc.mrc.ac.uk/training.html
---

In this exercise, we will read in a count data from erythroblast differentiation experiment in mice. This data was downloaded from GEO database (http://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE49843) and aligned to mm9 genome assembly using  Rsubread R package. More details with regards to this experiment please refer to (http://www.ncbi.nlm.nih.gov/pubmed/24092935). 

* Material

(1) Sample description: Exercise_ShortRNAseq_sample.info

(2) Count data: Exercise_ShortRNAseq_counts.csv



1. 

   a) First read in the sample informattion and count data.

   b) Identify how many factors this experiment involves.

```{r,collapse=T,warning=FALSE}

suppressPackageStartupMessages(library(DESeq2))

# load the sample description that we generated manually for this exercise

targets <- read.table("Exercise_ShortRNAseq_sample.info",sep="\t",header=TRUE)

# check the content of "targets" object that we just created

targets

```

In this experiment, we have two factors, namely, condition and batch. (ps: we introduced the 'mock' batch factor for this exercise. In the original publication, the batch effect was not discussed).

For the condition factor, we have 3 levels, namely FFa, KOa and KOb.

For the batch factor, we have 3 levels, namely a, b and c.

2. Construct DESeqDataSet object using sample information and counts data.

```{r,collapse=T,warning=FALSE}

# load the count information that we generated for this exercise by using Rsubread, featurecount function.

AllCounts<-read.csv(file="Exercise_ShortRNAseq_counts.csv",header=T,row.names=1)

# see the what is in the counts.csv

head(AllCounts)

# We provide entrez_id as identifier for this exercise

cData<-data.frame(name=targets$sample,condition=targets$condition,batch=targets$batch)

dds<-DESeqDataSetFromMatrix(countData= AllCounts,colData=cData,design=~batch+condition)

```


Now you have the count table as deseqdataset, you can start to perform the DE analysis.

3. a) Find the number of genes that are changed in knockdown samples versus control, i.e. KOa vs FFa and KOb vs FFa, at FDR 0.05 irrespective of fold change.

 b) Find the number of genes that are changed in the above situation with fold change threshold, i.e. fold change ratio > 2.


```{r, echo=T,warnings=F,collapse=T}

dds<-DESeq(dds)

# shows how many genes were differentially expressed in KOa vs FFa, with FDR<0.05
res1<-results(dds, contrast=c("condition","KOa","FFa"))
summary(res1,alpha=0.05)

# shows how many genes were differentially expressed in KOa vs FFa, with FDR<0.05 and fold change ratio > 2
DE_res1<- res1[complete.cases(res1$padj),]
DE_res1<- DE_res1[DE_res1$padj<0.05 & abs(DE_res1$log2FoldChange)>1,]

# shows how many genes were differentially expressed in KOb vs FFa, with FDR<0.05
res2<-results(dds, contrast=c("condition","KOb","FFa"))

# shows how many genes were differentially expressed in KOa vs FFa, with FDR<0.05 and fold change ratio > 2
DE_res2<- res2[complete.cases(res2$padj),]
DE_res2<- DE_res2[DE_res2$padj<0.05 & abs(DE_res2$log2FoldChange)>1,]


```



